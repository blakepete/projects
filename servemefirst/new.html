<!DOCTYPE html>
<html>
<title>ServeMeFirst Alpha 4.0.8</title>
<head>
<!Blake Peterson 2018
blake.r.peterson@gmail.com>
</head>
<body>

<table>
    <tbody id="dispBody"></tbody>
</table>
<p>
<div id="otherButtons">
    <button id="newTable" type="button" onclick="newTable()">newTable</button> 
</div>
</p>
<div id="buttons">
<p>
<div id="b1">
    <button id="ordergreet" type="button" onclick="order('greet')">Greet</button> 
</div>
</p>
<p>
<div id="b2">
    <button id="orderdrink" type="button" onclick="order('drink')">Order Drink</button>
    <button id="makedrink" type="button" onclick="make('drink')">Make Drink</button>
    <button id="dropdrink" type="button" onclick="drop('drink')">Drop Drink</button>
    <button id="busdrink" type="button" onclick="bus('drink')">Bus Drink</button>
</div>
</p>
<p>
<div id="b3">
    <button id="orderapp" type="button" onclick="order('app')">Order App</button>
    <button id="sendapp" type="button" onclick="send('app')">Send App</button>
    <button id="getapp" type="button" onclick="get('app')">Get App</button>
    <button id="dropapp" type="button" onclick="drop('app')">Drop App</button>
    <button id="busapp" type="button" onclick="bus('app')">Bus App</button>
</div>
</p>
<p>
    <div id="b4">
    <button id="makesalad" type="button" onclick="make('salad')">Make Salad</button>
    <button id="dropsalad" type="button" onclick="drop('salad')">Drop Salad</button>
    <button id="bussalad" type="button" onclick="bus('salad')">Bus Salad</button>
</div>
</p>
<p>
<div id="b5">
    <button id="orderentree" type="button" onclick="order('entree')">Order Entree</button>
    <button id="sendentree" type="button" onclick="send('entree')">Send Entree</button>
    <button id="getentree" type="button" onclick="get('entree')">Get Entree</button>
    <button id="dropentree" type="button" onclick="drop('entree')">Drop Entree</button>
    <button id="busentree" type="button" onclick="bus('entree')">Bus Entree</button>
</div>
</p>
<p>
<div id="b6">
    <button id="orderdessert" type="button" onclick="order('dessert')">Order Dessert</button>
    <button id="senddessert" type="button" onclick="send('dessert')">Send Dessert</button>
    <button id="getdessert" type="button" onclick="get('dessert')">Get Dessert</button>
    <button id="dropdessert" type="button" onclick="drop('dessert')">Drop Dessert</button>
    <button id="busdessert" type="button" onclick="bus('dessert')">Bus Dessert</button>
</div>
</p>
<p>
<div id="b7">
    <button id="makebill" type="button" onclick="make('bill')">Print Bill</button>
    <button id="dropbill" type="button" onclick="drop('bill')">Drop Bill</button>
    <button id="busbill" type="button" onclick="bus('bill')">Pick Up Bill</button>
</div>
</p>
<p>
<div id="b8">
    <button id="makereceipt" type="button" onclick="make('receipt')">Run Bill</button>
    <button id="dropreceipt" type="button" onclick="drop('receipt')">Drop Receipt</button>
    <button id="busreceipt" type="button" onclick="bus('receipt')">Pick Up Receipt</button>
</div>
</p>
</div>
<div id = "devButtons">
    <button id="debug" type="button" onclick="debug()">debug</button>
</div>
<p id="test">words</p>
<p id="test2">words</p>
</body>

<script>
var gTimer = 0;
var gTimerVar = 0;
var t = [
    { //table 0
        timeStart: 0,
        occupied: "no",
        course: {
            greet: {
                show: 0,
                needAct: 0,
                actDone: 0,
                orderTaken: 0,
                dispF: "order"
            },
            drink: {
                show: 0,
                needAct: 0,
                actDone: 0,
                orderTaken: 0,
                dropDue: 0,
                makeDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank",
                estTime: 45 //minutes
            },
            app: {
                show: 0,
                needAct: 0,
                actDone: 0,
                orderTaken: 0,
                dropDue: 0,
                makeSent: 0,
                makeDone: 0,
                makeReady: 0,
                sendDone: 0,
                makeGot: 0,
                orderDropd: 0,
                emptyDone: 0,
                bus: 0,
                dispF: "blank",
                estTime: 1 //minutes
            },
            salad: {
                show: 0,
                orderTaken: 0,
                dropDue: 0,
                makeDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank",
                estTime: 1 //minutes
            },
            entree: {
                show: 0,
                needAct: 0,
                actDone: 0,
                orderTaken: 0,
                dropDue: 0,
                makeSent: 0,
                makeDone: 0,
                makeReady: 0,
                sendDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank",
                estTime: 1 //minutes
            },
            dessert: {
                show: 0,
                needAct: 0,
                actDone: 0,
                orderTaken: 0,
                dropDue: 0,
                makeSent: 0,
                makeDone: 0,
                sendDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank",
                estTime: 1 //minutes
            },
            bill: {
                show: 0,
                orderTaken: 0,
                dropDue: 0,
                makeDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank"
            },
            receipt: {
                show: 0,
                orderTaken: 0,
                dropDue: 0,
                makeDone: 0,
                makeGot: 0,
                orderDropd: 0,
                dispF: "blank"
            },
        },
        g: [
            {//empty because these are actually disp columns and 0 is the sider
            },
            { //guest 1
                thirst: 0,
                hunger: 0,
                drinkEmpty: 0,
                saladEmpty: 0,
                entreeEmpty: 0,
                dessertEmpty: 0,
                saladBus: 0,
                entreeBus: 0,
                dessertBus: 0,
                billBus: 0,
                receiptBus: 0,
                debt: 0
            }
        ]
    }
];

window.onload = function(){
    displayButtons("none");
    gTimer = 0;
    gTimerVar = setInterval(function(){
        gTimer++;
        document.getElementById("test").innerHTML = gTimer;
        if (chillthefuckout == 1){
            update();
        }
    }, 1000);
};

var chillthefuckout= 0;
var tbl = 0;
var dispHedVar = [{
        "b0": "Table: ",
        "b1": "0",
        "b2": "Time",
        "b3": "0:00"
    }, {
        "b0": "Guests: ",
        "b1": "num",
        "b2": "Bill",
        "b3": "$0"
    }];
var dispTableVar = [
    {
    "g0": ""}, {
    "g0": "Greet"}, {
    "g0": "Drink"}, {
    "g0": "Appetizer"}, {
    "g0": "Salad"}, {
    "g0": "Entree"}, {
    "g0": "Dessert"}, {
    "g0": "Bill"}, {
    "g0": "Receipt"
}];
function displayTable(){
    var tbody = document.getElementById("dispBody");
    tbody.innerHTML = ""; //wipes old table
    for (var i = 0; i < Object.keys(dispHedVar).length; i++) {
        temp = "<tr id = \"" + "h" + i + "\">";
        for (let key in dispHedVar[i]) {
            temp += "<td id = \"" + "h" + i + key + "\">" + dispHedVar[i][key] + "</td>";
        } 
        tbody.innerHTML += temp;
    }   
    for (var j = 0; j < Object.keys(dispTableVar).length; j++) {
        temp = "<tr id = \"" + "c" + j + "\">";
        for (let key in dispTableVar[j]) {
            temp += "<td id = \"" + key + "c" + j + "\">" + dispTableVar[j][key] + "</td>";
        } 
        tbody.innerHTML += temp;
    }
    tbody.innerHTML += "<tr><td id=\"status\" colspan=\"4\">sup</tr></td>";
}
function addGuestDisp(k){
    for (var j = 0; j < k; j++){
        guestNum = Object.keys(dispTableVar[0]).length;
        dispTableVar[0]["g"+guestNum] = "Guest " + guestNum;
        for (var i = 1; i < Object.keys(dispTableVar).length; i++) {
            dispTableVar[i]["g"+guestNum] = "";
        }
    }
    displayTable();
}
function displayButtons(k){
    var el = document.getElementById('buttons');
    var all = el.getElementsByTagName('button');
    var i;
    for (i = 0; i < all.length; i++) {
       all[i].style.display = k;
    }
}
function disabledButtons(k){
    //enable buttons
    var el = document.getElementById('buttons');
    var all = el.getElementsByTagName('button');
    var i;
    for (i = 0; i < all.length; i++) {
        all[i].disabled = k;
    }
}
function getRnd(min, max) {
    //returns int; min (included) and max (excluded)
    return Math.floor(Math.random() * (max - min) ) + min;
}

function addGuestInit(k){
    for (j = 1; j < k; j++){
        guestNum = t[tbl].g.length; 
        t[tbl].g[guestNum] = {};
        temp = Object.getOwnPropertyNames(t[tbl].g[1]);
        for (var i = 0; i < Object.keys(t[tbl].g[1]).length; i++) {
            nowTemp = temp[i];
            t[tbl].g[guestNum][[nowTemp]] = 0;
        }
    }
}

function update(){
    document.getElementById("h0b1").innerHTML= tbl;
    document.getElementById("h0b3").innerHTML= formatTime(getTableTime(tbl));
    document.getElementById("h1b1").innerHTML= t[tbl].g.length - 1;
    document.getElementById("h1b3").innerHTML= "$ " + addBill();
    var x, y;
    var temp = Object.getOwnPropertyNames(t[tbl].course);
    for(i = 0; i < Object.keys(t[tbl].course).length; i++){
        nowTemp = temp[i];
        switch(t[tbl].course[[nowTemp]].show){
            case 1:
                x = "visible";
                y = "inline";
                break;
            case 0:
                x = "hidden";
                y = "none";
                break;
            }
        document.getElementById(["c"+(i+1)]).style.visibility = x;
        document.getElementById(["b"+(i+1)]).style.display = y;
    }
    for (var j = 1; j < t[tbl].g.length; j++) {
        for (var p = 0; p < 6; p++){
            var cell = ("g"+j+"c"+(p+1));
            var c = temp[p];
            var f = t[tbl].course[c].dispF;
            var z = stage[c][f](j,c);
            document.getElementById(cell).innerHTML= z;
        }
    }
    if (t[tbl].occupied > getTableTime()){
        disabledButtons(true);
        document.getElementById("status").innerHTML= "busy " + formatTime(t[tbl].occupied - getTableTime());
    } else {
        disabledButtons(false);
        document.getElementById("status").innerHTML= "do something";
        if ((t[tbl].course.app.orderSent == 1) && (t[tbl].course.app.makeReady != 1)){
            document.getElementById("getapp").disabled = true;
            document.getElementById("status").innerHTML= "cooking " + formatTime(t[tbl].course.app.makeDone - getTableTime());
        }
        if ((t[tbl].course.entree.orderSent == 1) && (t[tbl].course.entree.makeReady != 1)){
            document.getElementById("getentree").disabled = true;
            document.getElementById("status").innerHTML= "cooking " + formatTime(t[tbl].course.entree.makeDone - getTableTime());
        }
        if ((t[tbl].course.dessert.orderSent == 1) && (t[tbl].course.dessert.makeReady != 1)){
            document.getElementById("getdessert").disabled = true;
            document.getElementById("status").innerHTML= "cooking " + formatTime(t[tbl].course.dessert.makeDone - getTableTime());
        }
    }
//    if (t[tbl].course.greet.orderTaken == 1){
//        t[tbl].course.greet.show = 0;
//        document.getElementById("g1c1").innerHTML= "Greeted";
//    } else if (t[tbl].course.greet.orderTaken === 0){
//        t[tbl].course.greet.show = 1;
//        document.getElementById("g1c1").innerHTML= "Greet " + formatTime(timeLeft("greet","needAct"));
//    }
}
function getTableTime(tbl = 0){
    return (gTimer - t[tbl].timeStart);
}
function formatTime(s) {
    //source: https://stackoverflow.com/a/37770048
    return(0>s?(s=-s,'-'):0)+(s-(s%=60))/60+(9<s?':':':0')+s;
}

function newTable(){
    guestCount = getRnd(1,5);
    addGuestInit(guestCount);
    addGuestDisp(guestCount);
    displayTable();
    t[tbl].timeStart = gTimer;
    for (i = 1; i < (t[tbl].g.length); i++){
        temp = Object.getOwnPropertyNames(t[tbl].g[1]);
        for (var j = 0; j < Object.keys(t[tbl].g[1]).length; j++) {
            nowTemp = temp[j];
            setGVar(i,nowTemp);
        }
    }
    document.getElementById("newTable").style.display = "none";
    chillthefuckout = 1;
    t[tbl].course.greet.show = 1;
    document.getElementById("ordergreet").style.display = "inline";
    t[tbl].course.greet.needAct = 5;
}

function setGVar(guest,prop){
    switch (prop){
        case "thirst":
        case "hunger":
            t[tbl].g[guest][prop] = getRnd(1, 5);
            break;
        default:
            t[tbl].g[guest][prop] = 0;
            break;
    }
}

function debug(){
}

function addBill(){
    var sum = 0;
    for(i = 1; i < (t[tbl].g.length); i++){
        sum += t[tbl].g[i].debt;
    }
  return sum;
}

function order(k){
    t[tbl].occupied = setEndTime(k,"actDone",3);
    t[tbl].course[k].dispF = "ordering";
    var d = "order"+k;
    document.getElementById(d).style.display = "none";
    setEndTime(k,"dropDue",120);
    switch(k){
        case 'greet':
            t[tbl].course.drink.show = 1;
            t[tbl].course.drink.dispF = "order";
            t[tbl].course.drink.needAct = 30 + getTableTime();
            document.getElementById("orderdrink").style.display = "inline";
            break;
        case 'drink':
            t[tbl].course.greet.show = 0;
            t[tbl].course.app.show = 1;
            t[tbl].course.app.dispF = "blank";
            document.getElementById("makedrink").style.display = "inline";
            document.getElementById("orderapp").style.display = "inline";
            break;
        case 'app':
            document.getElementById("sendapp").style.display = "inline";
            break;
        case 'entree':
            document.getElementById("sendentree").style.display = "inline";
            document.getElementById("makesalad").style.display = "inline";
            break;
        case 'dessert':
            document.getElementById("senddessert").style.display = "inline";
            break;
    }
    update();
}
function make(k){
    t[tbl].occupied = setEndTime(k,"makeDone",4);
    makeWatcher = setInterval(function() {
        t[tbl].course[k].makeGot = endWatcher(t[tbl].course[k].makeDone,[makeWatcher]);
    }, 1000);
    switch(k){ //need if checks for orderTaken
        case 'drink':
            document.getElementById("dropdrink").style.display = "inline";
            document.getElementById("makedrink").style.display = "none";
            break;
        case 'salad':
            document.getElementById("dropsalad").style.display = "inline";
            document.getElementById("makesalad").style.display = "none";
            break;
        case 'bill':
            document.getElementById("dropbill").style.display = "inline";
            document.getElementById("makebill").style.display = "none";
            break;
        case 'receipt':
            document.getElementById("dropreceipt").style.display = "inline";
            document.getElementById("makereceipt").style.display = "none";
            break;
    }
    update();
}
function send(k){
    t[tbl].occupied = setEndTime(k,"makeDone",7);
    t[tbl].occupied = setEndTime(k,"sendDone",3);
    t[tbl].course[k].orderSent = 1;
    sendWatcher = setInterval(function() {
        t[tbl].course[k].makeReady = endWatcher(t[tbl].course[k].makeDone,[sendWatcher]);
    }, 1000);
    switch(k){
        case 'app':
            //setEndTime("app","makeDone",180);
            //setEndTime("app","sendDone",15);
            document.getElementById("sendapp").style.display = "none";
            document.getElementById("getapp").style.display = "inline";
            document.getElementById("getapp").disabled = true;
            //t[tbl].occupied = "sendapp";
            break;
        case 'entree':
            //setEndTime("entree","makeDone",600);
            //setEndTime("entree","sendDone",30);
            document.getElementById("sendentree").style.display = "none";
            document.getElementById("getentree").style.display = "inline";
            //t[tbl].occupied = "sendentree";
            break;
        case 'dessert':
            //setEndTime("dessert","makeDone",180);
            //setEndTime("dessert","sendDone",15);
            document.getElementById("senddessert").style.display = "none";
            document.getElementById("getdessert").style.display = "inline";
            //t[tbl].occupied = "senddessert";
            break;
    }
    update();
}
function get(k){
    switch(k){
        case 'app':
            if (t[tbl].course.app.makeDone <= getTableTime()){
                t[tbl].course.app.makeGot = 1;
                document.getElementById("getapp").innerHTML= "Get App";
                document.getElementById("dropapp").style.display = "inline";
                document.getElementById("getapp").style.display = "none";
            }
            update();
            break;
        case 'entree':
            if (t[tbl].course.entree.makeDone <= getTableTime()){
                t[tbl].course.entree.makeGot = 1;
                document.getElementById("getentree").innerHTML= "Get Entree";
                document.getElementById("dropentree").style.display = "inline";
                document.getElementById("getentree").style.display = "none";
            }
            update();
            break;
        case 'dessert':
            if (t[tbl].course.dessert.makeDone <= getTableTime()){
                t[tbl].course.dessert.makeGot = 1;
                document.getElementById("getdessert").innerHTML= "Get Dessert";
                document.getElementById("dropdessert").style.display = "inline";
                document.getElementById("getdessert").style.display = "none";
            }
            update();
            break;
    }
}
function drop(k){
    if(t[tbl].course[k].makeGot == 1){
        t[tbl].course[k].makeGot = 0;
        t[tbl].course[k].orderDropd = 1;
        t[tbl].course[k].dispF = "dropd";
        var d = "bus"+k;
        document.getElementById(d).style.display = "inline";
        document.getElementById("busdrink").style.display = "none";
        switch(k){
            case 'drink':
                for (var j = 1; j < t[tbl].g.length; j++) {
                    setEmptyTime(j,"drinkEmpty",k);
                }
                document.getElementById("dropdrink").style.display = "none";
                document.getElementById("makedrink").style.display = "inline";
                break;
            case 'app':
                setEmptyTime("app","emptyDone",k);
                document.getElementById("dropapp").style.display = "none";
                document.getElementById("orderentree").style.display = "inline";
                t[tbl].course.salad.show = 1;
                t[tbl].course.entree.show = 1;
                setEndTime("entree","needAct",120);
                break;
            case 'salad':
                for (var j = 1; j < t[tbl].g.length; j++) {
                    setEmptyTime(j,"saladEmpty",k);
                }
                document.getElementById("dropsalad").style.display = "none";
                break;
            case 'entree':
                for (var j = 1; j < t[tbl].g.length; j++) {
                    setEmptyTime(j,"entreeEmpty",k);
                }
                document.getElementById("dropentree").style.display = "none";
                document.getElementById("orderdessert").style.display = "inline";
                t[tbl].course.dessert.show = 1;
                break;
            case 'dessert':
                for (var j = 1; j < t[tbl].g.length; j++) {
                    setEmptyTime(j,"dessertEmpty",k);
                }
                document.getElementById("dropdessert").style.display = "none";
                document.getElementById("makebill").style.display = "inline";
                t[tbl].course.bill.show = 1;
                //t[tbl].course.bill.orderTaken = 1;
                setEndTime("bill","dropDue",300);
                break;
            case 'bill':
                setEmptyTime(0,"billEmpty",100);
                setEmptyTime(1,"billEmpty",100);
                document.getElementById("dropbill").style.display = "none";
                t[tbl].course.receipt.orderTaken = 1;
                setEndTime("receipt","dropDue",300);
                setEndTime("receipt","needAct",300);
                break;
            case 'receipt':
                setEmptyTime(0,"receiptEmpty",100);
                setEmptyTime(1,"receiptEmpty",100);
                document.getElementById("dropreceipt").style.display = "none";
                break;
        }
        update();
    }
}
function bus(k){
    switch(k){
        case 'app':
            if(t[tbl].course.app.emptyDone <= getTableTime()){
                t[tbl].course.app.bus = 1;
                document.getElementById("busapp").style.display = "none";
                t[tbl].course.app.dispF = "bus";
            }
            break;
        case 'salad':
            for (var j = 1; j < t[tbl].g.length; j++) {
                if(t[tbl].g[j].saladEmpty <= getTableTime(tbl)){
                    t[tbl].g[j].saladBus = 1;
                    //t[tbl].course[k].dispF = "bus";
                    //document.getElementById("bussalad").style.display = "none";
                }
            }
            break;
        case 'entree':
            for (var j = 1; j < t[tbl].g.length; j++) {
                if(t[tbl].g[j].entreeEmpty <= getTableTime()){
                    t[tbl].g[j].entreeBus = 1;
                    //t[tbl].course[k].dispF = "bus";
                    //document.getElementById("busentree").style.display = "none";
                }
            }
            break;
        case 'dessert':
            for (var j = 1; j < t[tbl].g.length; j++) {
                if(t[tbl].g[j].dessertEmpty <= getTableTime()){
                    t[tbl].g[j].dessertBus = 1;
                    //t[tbl].course[k].dispF = "bus";
                    //document.getElementById("busdessert").style.display = "none";
                }
            }
            break;
        case 'bill':
            if ((t[tbl].g[0].billEmpty <= getTableTime()) && (t[tbl].g[1].billEmpty <= getTableTime())){
                t[tbl].g[0].billBus = 1;
                t[tbl].g[1].billBus = 1;
                t[0].course.receipt.show = 1;
                document.getElementById("busbill").style.display = "none";
                document.getElementById("makereceipt").style.display = "inline";
            }
            break;
    }
    update();
}


function setEndTime(c,x,y){
    return t[tbl].course[c][x] = (getTableTime(tbl) + y);
}

var stage = { //possible new data structure.
    greet: {
        blank: function() {
            return "";
        },
        order: function() {
            if (timeLeft("greet","needAct") <= 0){
                return "late";
            } else {
                return ("Greet " + formatTime(timeLeft("greet","needAct")));
            }
        },
        ordering: function() {
            if (timeLeft("greet","actDone") <= 0){
                return "Greeted";
            } else {
                return ("Greeting " + formatTime(timeLeft("greet","actDone")));
            }
        }
    },
    drink: {
        blank: function() {
            return "";
        },
        order: function() {
            if (timeLeft("drink","needAct") <= 0){
                return "late";
            } else {
                return ("Order Drink " + formatTime(timeLeft("drink","needAct")));
            }
        },
        ordering: function() {
            if (timeLeft("drink","actDone") <= 0){
                return ("Waiting " + formatTime(timeLeft("drink","dropDue")));
            } else {
                return ("Ordering " + formatTime(timeLeft("drink","actDone")));
            }
        },
        taken:"f",
        sent:"d",
        making:"f",
        done:"g",
        got:"h",
        dropd: function(g,k) {
            return ("Drinking " + centLeft(g,"drinkEmpty",k));
        },
        dirty:"k",
        bus:"l"
    },
    app: {
        blank: function() {
            return "";
        },
        order: function() {
            if (timeLeft("app","needAct") <= 0){
                return "late";
            } else {
                return ("app " + formatTime(timeLeft("app","needAct")));
            }
        },
        ordering: function() {
            if (timeLeft("app","actDone") <= 0){
                return ("Waiting " + formatTime(timeLeft("app","dropDue")));
            } else {
                return ("Ordering " + formatTime(timeLeft("app","actDone")));
            }
        },
        taken:"s",
        sending:"f",
        sent:"d",
        done:"g",
        got:"h",
        dropd: function(g,k) {
            return ("Eating " + centLeft("app","emptyDone",k));
        },
        dirty:"k",
        bus: function() {
            return "";
        }
    },
    salad: {
        blank: function() {
            return "";
        },
        order: function() {
            if (timeLeft("salad","needAct") <= 0){
                return "late";
            } else {
                return ("Order " + formatTime(timeLeft("salad","needAct")));
            }
        },
        ordering: function() {
            if (timeLeft("salad","actDone") <= 0){
                return ("Waiting " + formatTime(timeLeft("salad","dropDue")));
            } else {
                return ("Ordering " + formatTime(timeLeft("salad","actDone")));
            }
        },
        taken:"s",
        sent:"d",
        making:"f",
        done:"g",
        got:"h",
        dropd: function(g,k) {
            if (t[tbl].g[g].saladBus == 1){
                return "";
            } else {
            return ("Eating " + centLeft(g,"saladEmpty",k));
            }
        },
        dirty:"k",
        bus:"j"
    },
    entree: {
        blank: function() {
            return "";
        },
        order: function() {
            if (timeLeft("entree","needAct") <= 0){
                return "late";
            } else {
                return ("Order " + formatTime(timeLeft("entree","needAct")));
            }
        },
        ordering: function() {
            if (timeLeft("entree","actDone") <= 0){
                return ("Waiting " + formatTime(timeLeft("entree","dropDue")));
            } else {
                return ("Ordering " + formatTime(timeLeft("entree","actDone")));
            }
        },
        taken:"s",
        sending:"f",
        sent:"d",
        done:"g",
        got:"h",
        dropd: function(g,k) {
            if (t[tbl].g[g].entreeBus == 1){
                return "";
            } else {
            return ("Eating " + centLeft(g,"entreeEmpty",k));
            }
        },
        dirty:"k",
        bus: function() {
            return "";
        }
    },
    dessert: {
        blank: function() {
            return "";
        },
        order: function() {
            return ("dessert " + formatTime(timeLeft("dessert","needAct")));
        },
        ordering: function() {
            if (timeLeft("dessert","actDone") <= 0){
                return ("Waiting " + formatTime(timeLeft("dessert","dropDue")));
            } else {
                return ("Ordering " + formatTime(timeLeft("dessert","actDone")));
            }
        },
        taken:"s",
        sending:"f",
        sent:"d",
        done:"g",
        got:"h",
        dropd: function(g,k) {
            if (t[tbl].g[g].dessertBus == 1){
                return "";
            } else {
            return ("Eating " + centLeft(g,"dessertEmpty",k));
            }
        },
        dirty:"k",
        bus: function() {
            return "";
        }
    },
    bill: {
        blank:"a",
        taken:"s",
        sent:"d",
        making:"f",
        done:"g",
        got:"h",
        dropd:"j",
        dirty:"k",
        bus:"l"
    },
    receipt:{
        blank:"a",
        taken:"s",
        sent:"d",
        making:"f",
        done:"g",
        got:"h",
        dropd:"j"
    },
};

function timeLeft(c,x){
    return (t[tbl].course[c][x] - getTableTime());
}

function endWatcher(time,flag){
    if (time <= (getTableTime(tbl))+1){
        clearInterval(flag);
        return 1; //make got, etc
    }
}

function centLeft(c,x,z){
    var y = (t[tbl].course[z].estTime * 0.6);
    var temp = 0;
    if (c == "app"){
        y = (t[tbl].course.app.estTime * 0.6);
        for (var j = 1; j < t[tbl].g.length; j++) {
            temp += t[tbl].g[j].thirst;
        }
        temp = temp / t[tbl].g.length;
        return ((Math.round((t[tbl].course[c][x] - getTableTime(tbl)) / (y * (1 / temp)))) + "%");
    } else {
        temp = t[tbl].g[c].thirst;
        return ((Math.round((t[tbl].g[[c]][x] - getTableTime(tbl)) / (y * (1 / temp))))+ "%");
    }
}

function setEmptyTime(c,x,z){
    document.getElementById("test2").innerHTML+= z;
    var y = (t[tbl].course[z].estTime * 60);
    var temp = 0;
    if (c == "app"){
        y = (t[tbl].course.app.estTime * 60);
        for (var j = 1; j < t[tbl].g.length; j++) {
            temp += t[tbl].g[j].thirst;
        }
        temp = temp / t[tbl].g.length;
        t[tbl].course[c][x] = getTableTime(tbl) + (y * (1 / temp));
    } else {
        temp = t[tbl].g[c].thirst;
        t[tbl].g[c][x] = getTableTime(tbl) + (y * (1 / temp));
    }
}

</script>